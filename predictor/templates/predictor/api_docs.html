{% extends 'predictor/base.html' %}

{% block title %}API Documentation{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">Diabetes Prediction API Documentation</h1>
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Overview</h3>
                </div>
                <div class="card-body">
                    <p>The Diabetes Prediction API allows developers to integrate our high-accuracy prediction model into their applications. The API accepts patient health metrics and returns a diabetes risk prediction along with risk factors and details.</p>
                    <p>The model has been trained on a balanced dataset with over 2,000 samples and uses an ensemble approach that combines multiple machine learning algorithms for high accuracy (99.7%).</p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">API Endpoint</h3>
                </div>
                <div class="card-body">
                    <p><strong>URL:</strong> <code>/api/predict/</code></p>
                    <p><strong>Method:</strong> POST</p>
                    <p><strong>Content-Type:</strong> application/json</p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Request Parameters</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                    <th>Required</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>gender</code></td>
                                    <td>string</td>
                                    <td>Patient gender ("M" or "F")</td>
                                    <td>Yes</td>
                                    <td>"M"</td>
                                </tr>
                                <tr>
                                    <td><code>age</code></td>
                                    <td>number</td>
                                    <td>Patient age in years</td>
                                    <td>Yes</td>
                                    <td>45</td>
                                </tr>
                                <tr>
                                    <td><code>urea</code></td>
                                    <td>number</td>
                                    <td>Blood urea level (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>30</td>
                                </tr>
                                <tr>
                                    <td><code>cr</code></td>
                                    <td>number</td>
                                    <td>Creatinine level (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>0.9</td>
                                </tr>
                                <tr>
                                    <td><code>hba1c</code></td>
                                    <td>number</td>
                                    <td>HbA1c percentage</td>
                                    <td>Yes</td>
                                    <td>6.0</td>
                                </tr>
                                <tr>
                                    <td><code>chol</code></td>
                                    <td>number</td>
                                    <td>Total cholesterol (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>190</td>
                                </tr>
                                <tr>
                                    <td><code>tg</code></td>
                                    <td>number</td>
                                    <td>Triglycerides (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>150</td>
                                </tr>
                                <tr>
                                    <td><code>hdl</code></td>
                                    <td>number</td>
                                    <td>HDL cholesterol (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>45</td>
                                </tr>
                                <tr>
                                    <td><code>ldl</code></td>
                                    <td>number</td>
                                    <td>LDL cholesterol (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>120</td>
                                </tr>
                                <tr>
                                    <td><code>vldl</code></td>
                                    <td>number</td>
                                    <td>VLDL cholesterol (mg/dL)</td>
                                    <td>Yes</td>
                                    <td>25</td>
                                </tr>
                                <tr>
                                    <td><code>bmi</code></td>
                                    <td>number</td>
                                    <td>Body Mass Index (kg/m²)</td>
                                    <td>Yes</td>
                                    <td>26.5</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Response Format</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Field</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>success</code></td>
                                    <td>boolean</td>
                                    <td>Whether the request was successful</td>
                                </tr>
                                <tr>
                                    <td><code>prediction</code></td>
                                    <td>string</td>
                                    <td>Prediction result: "No", "Possible", or "Yes"</td>
                                </tr>
                                <tr>
                                    <td><code>probability</code></td>
                                    <td>string</td>
                                    <td>Formatted probability of the prediction (e.g., "0.9432")</td>
                                </tr>
                                <tr>
                                    <td><code>probability_raw</code></td>
                                    <td>number</td>
                                    <td>Raw probability value (e.g., 0.9432)</td>
                                </tr>
                                <tr>
                                    <td><code>risk_factors</code></td>
                                    <td>array</td>
                                    <td>List of identified risk factors</td>
                                </tr>
                                <tr>
                                    <td><code>risk_details</code></td>
                                    <td>string</td>
                                    <td>Textual description of risk assessment</td>
                                </tr>
                                <tr>
                                    <td><code>error</code></td>
                                    <td>string</td>
                                    <td>Error message (only present if success is false)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Example Request</h3>
                </div>
                <div class="card-body">
                    <pre class="bg-light p-3 rounded"><code>
POST /api/predict/ HTTP/1.1
Host: example.com
Content-Type: application/json

{
    "gender": "M",
    "age": 45,
    "urea": 30,
    "cr": 0.9,
    "hba1c": 6.0,
    "chol": 190,
    "tg": 150,
    "hdl": 45,
    "ldl": 120,
    "vldl": 25,
    "bmi": 26.5
}
                    </code></pre>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Example Response</h3>
                </div>
                <div class="card-body">
                    <pre class="bg-light p-3 rounded"><code>
HTTP/1.1 200 OK
Content-Type: application/json

{
    "success": true,
    "prediction": "Possible",
    "probability": "0.8756",
    "probability_raw": 0.8756,
    "risk_factors": [
        "Age above 45",
        "Overweight (BMI ≥ 25)",
        "HbA1c 5.7-6.4% (Prediabetes range)",
        "Elevated Triglycerides"
    ],
    "risk_details": "Moderate risk of diabetes. Several risk factors present."
}
                    </code></pre>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Error Responses</h3>
                </div>
                <div class="card-body">
                    <h5>400 Bad Request</h5>
                    <pre class="bg-light p-3 rounded"><code>
{
    "success": false,
    "error": "Invalid JSON data in request body"
}
                    </code></pre>

                    <h5 class="mt-4">405 Method Not Allowed</h5>
                    <pre class="bg-light p-3 rounded"><code>
{
    "success": false,
    "error": "Only POST method is supported for this endpoint"
}
                    </code></pre>

                    <h5 class="mt-4">500 Internal Server Error</h5>
                    <pre class="bg-light p-3 rounded"><code>
{
    "success": false,
    "error": "An error occurred: [error details]"
}
                    </code></pre>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Rate Limiting</h3>
                </div>
                <div class="card-body">
                    <p>The API is currently rate limited to 100 requests per hour per IP address. If you need higher limits, please contact us.</p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Code Examples</h3>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="codeExampleTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="python-tab" data-bs-toggle="tab" data-bs-target="#python" type="button" role="tab" aria-controls="python" aria-selected="true">Python</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="javascript-tab" data-bs-toggle="tab" data-bs-target="#javascript" type="button" role="tab" aria-controls="javascript" aria-selected="false">JavaScript</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="curl-tab" data-bs-toggle="tab" data-bs-target="#curl" type="button" role="tab" aria-controls="curl" aria-selected="false">cURL</button>
                        </li>
                    </ul>
                    <div class="tab-content p-3 border border-top-0 rounded-bottom" id="codeExampleTabContent">
                        <div class="tab-pane fade show active" id="python" role="tabpanel" aria-labelledby="python-tab">
                            <pre><code>
import requests
import json

# API endpoint
url = "https://example.com/api/predict/"

# Patient data
patient_data = {
    "gender": "M",
    "age": 45,
    "urea": 30,
    "cr": 0.9,
    "hba1c": 6.0,
    "chol": 190,
    "tg": 150,
    "hdl": 45,
    "ldl": 120,
    "vldl": 25,
    "bmi": 26.5
}

# Make the request
response = requests.post(url, json=patient_data)

# Process the response
if response.status_code == 200:
    result = response.json()
    print(f"Prediction: {result['prediction']}")
    print(f"Probability: {result['probability']}")
    print(f"Risk Factors: {', '.join(result['risk_factors'])}")
    print(f"Risk Details: {result['risk_details']}")
else:
    print(f"Error: {response.status_code}")
    print(response.text)
                            </code></pre>
                        </div>
                        <div class="tab-pane fade" id="javascript" role="tabpanel" aria-labelledby="javascript-tab">
                            <pre><code>
// Using fetch API
const apiUrl = 'https://example.com/api/predict/';

const patientData = {
    gender: 'M',
    age: 45,
    urea: 30,
    cr: 0.9,
    hba1c: 6.0,
    chol: 190,
    tg: 150,
    hdl: 45,
    ldl: 120,
    vldl: 25,
    bmi: 26.5
};

fetch(apiUrl, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(patientData)
})
.then(response => response.json())
.then(data => {
    if (data.success) {
        console.log('Prediction:', data.prediction);
        console.log('Probability:', data.probability);
        console.log('Risk Factors:', data.risk_factors.join(', '));
        console.log('Risk Details:', data.risk_details);
    } else {
        console.error('Error:', data.error);
    }
})
.catch(error => {
    console.error('Request failed:', error);
});
                            </code></pre>
                        </div>
                        <div class="tab-pane fade" id="curl" role="tabpanel" aria-labelledby="curl-tab">
                            <pre><code>
curl -X POST https://example.com/api/predict/ \
  -H "Content-Type: application/json" \
  -d '{
    "gender": "M",
    "age": 45,
    "urea": 30,
    "cr": 0.9,
    "hba1c": 6.0,
    "chol": 190,
    "tg": 150,
    "hdl": 45,
    "ldl": 120,
    "vldl": 25,
    "bmi": 26.5
  }'
                            </code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 